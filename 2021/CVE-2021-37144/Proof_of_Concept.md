**Vulnerability Name:** Multiple Arbitrary File Deletion

**Date of Discovery:** 20 July 2021

**Product version:** 1.2.9 [Download link](https://sourceforge.net/projects/cszcms/files/)

**Author:** faisalfs10x

**Vulnerability Description:** When unsanitized user input is supplied to a file deletion function, an arbitrary file deletion vulnerability arises. This occurs in PHP when the unlink() function is called and user input might affect portions of or the whole affected parameter, which represents the path of the file to remove, without sufficient sanitization. Exploiting the vulnerability allows an attacker to delete any file in the web root (along with any other file on the server that the PHP process user has the proper permissions to delete). Furthermore, an attacker can leverage the capability of arbitrary file deletion to circumvent certain webserver security mechanisms such as deleting .htaccess file that would deactivate those security constraints. 


---

**Proof of Concept 1**

- **Vulnerable URL:** http://localhost/CSZCMS-V1.2.9/member/edit/save
- **Vulnerable Code:** line 2141 - cszcms\models\Csz_model.php

![image](https://user-images.githubusercontent.com/51811615/127947875-7dfa1852-1146-4794-889e-cd29f820c8f1.png)


**Steps to Reproduce:**
1. Login as member
2. Goto Edit Profile
3. Upload any image as profile picture and click save button - refresh
4. Click "Delete File" checkbox and click save button
5. Intercept the request and replace existing image to any files on the server via parameter "del_file".

![image](https://user-images.githubusercontent.com/51811615/127955670-9323ef0b-2057-4bc3-a219-abba98672ca0.png)

---

**Proof of Concept 2**

- **Vulnerable URL:** http://localhost/CSZCMS-V1.2.9/admin/plugin/article/editArtSave
- **Vulnerable Code:** line 116, 131 - cszcms\models\plugin\Article_model.php

![image](https://user-images.githubusercontent.com/51811615/127947875-7dfa1852-1146-4794-889e-cd29f820c8f1.png)


**Steps to Reproduce:**
1. Login as admin
2. Goto Plugin Manager > Article > edit any article
3. Upload any image as "Main Picture" and "File Upload" and click save button
4. Click "Delete File" button for both "Main Picture" and "File Upload" and click save button
5. Intercept the request and replace existing image to any files on the server via parameter "del_file" and "del_file2"

![image](https://user-images.githubusercontent.com/51811615/127955902-58f94966-dba4-42de-b12d-380ebaa4992d.png)

---
**Proof of Concept 3**

- **Vulnerable URL:** http://localhost/CSZCMS-V1.2.9/admin/settings/update
- **Vulnerable Code:** line 944, 958 - cszcms\models\Csz_admin_model.php

![image](https://user-images.githubusercontent.com/51811615/126389724-e226072a-fa7e-43f8-b90b-ec66d1cb91fb.png)


**Step to Reproduce:**
1. Login as admin
2. Goto General Menu > Site Setting
3. Upload any image as "Site Logo" and "Image of og metatag" and click save button
4. Click "Delete File" button for both "Site Logo" and "Image of og metatag" and click save button
5. Intercept the request and replace existing image to any files on the server via parameter "del_file" and "del_og_image"

![image](https://user-images.githubusercontent.com/51811615/126390075-15c1d673-278d-4384-9351-8443cec86e10.png)


**References:** https://github.com/cskaza/cszcms/issues/32
